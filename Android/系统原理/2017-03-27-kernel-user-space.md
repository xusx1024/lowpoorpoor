---
layout: post
title:  Linux基础知识：内核空间和用户空间
date:   2017-03-27
categories: Operation System
tag: 杂项
---
 
 
1. 内核空间和用户空间都是指虚拟空间即虚拟地址。目前32位系统共有4G的虚拟地址空间
2. 内核空间即操作系统内核工作的空间，由内核负责映射，有固定的页表
3. 用户空间对应进程，进程切换，用户空间会跟着变化；每个进程的用户空间完全独立互不相干
 


操作系统为了保护自己不被普通程序破坏，对内核空间进行了一些定义，比如访问权限，换入换出，优先级等。内核空间的页表是常驻内存的，不会被虚拟内存管理模块换出到磁盘上。内核空间的程序一旦出错，系统会立即死机。

在开发驱动时需要用到内核空间和用户空间之间的接口，即内核空间和用户空间相互左右。一般模式为：<br/>
- 首先，编写内核服务程序利用内核空间提供的权限和服务来接收、处理和缓存数据；
- 然后，编写用户程序来配置内核服务程序的参数，输入待处理数据，提取内核服务程序提供的数据；


虚拟空间读取数据伪代码：
	
	if(数据在物理内存中) 
	        {        虚拟地址转换成物理地址 
	                 读数据 } 
	        else 
	        {     if(数据在磁盘中) 
	              { 
	                     if(物理内存还有空闲) 
	                     {          把数据从磁盘中读到物理内存 
	                                 虚拟地址转换成物理地址 
	                                 读数据 
	                     } 
	                     else 
	                     {          把物理内存中某页的数据存入磁盘 
	                                 把要读的数据从磁盘读到该页的物理内存中 
	                                 虚拟地址转换成物理地址 
	                                 读数据 
	                     } 
	              } 
	              else 
	              {     报错        } }
	
	    