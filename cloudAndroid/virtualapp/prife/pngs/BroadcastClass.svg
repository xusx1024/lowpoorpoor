<?xml version="1.0" encoding="UTF-8" standalone="yes"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" height="518.4px" style="width:674px;height:518px;" version="1.1" viewBox="0 0 674 518" width="675px"><defs><filter height="300%" id="f1" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="1.7999999523162842"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="3.5999999046325684" dy="3.5999999046325684" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><polygon fill="#FBFB77" filter="url(#f1)" points="122.625,7.2,122.625,138.7758,495.225,138.7758,495.225,16.2,486.225,7.2,122.625,7.2" style="stroke: #A80036; stroke-width: 0.8999999761581421;"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="486.225" x2="486.225" y1="7.2" y2="16.2"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="495.225" x2="486.225" y1="16.2" y2="16.2"/><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="46.8" x="128.025" y="22.5602">类说明：</text><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="281.7" x="128.025" y="36.1797">ReceiverDispatcher、InnerReceiver都是静态内部类</text><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="313.2" x="128.025" y="49.7993">LoadedApk.ReceiverDispatcher.InnerReceiver 是个Bn端</text><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="0" x="131.625" y="63.4188"/><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="332.1" x="128.025" y="77.0383">Client注册广播接收器时，创建了InnerReceiver对象，并传递给</text><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="192.6" x="128.025" y="90.6579">system_server进程中的AMS服务。</text><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="0" x="131.625" y="104.2774"/><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="353.7" x="128.025" y="117.8969">当其他应用向该应用发送广播时，AMS匹配到要发送给本应用后，就</text><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="265.5" x="128.025" y="131.5165">通过内核binder驱动回调InnerReceiver对象的方法</text><rect fill="#FEFECE" filter="url(#f1)" height="54.7242" style="stroke: #A80036; stroke-width: 1.3499999642372131;" width="137.7" x="5.4" y="203.85"/><ellipse cx="39.96" cy="218.25" fill="#ADD1B2" rx="9.9" ry="9.9" style="stroke: #A80036; stroke-width: 0.8999999761581421;"/><path d="M42.6319,223.3266 Q42.1116,223.5937 41.535,223.7273 Q40.9584,223.8609 40.3256,223.8609 Q38.0756,223.8609 36.8873,222.3773 Q35.6991,220.8937 35.6991,218.0812 Q35.6991,215.2687 36.8873,213.7781 Q38.0756,212.2875 40.3256,212.2875 Q40.9584,212.2875 41.542,212.4281 Q42.1256,212.5687 42.6319,212.8359 L42.6319,215.2828 Q42.0694,214.7625 41.535,214.5164 Q41.0006,214.2703 40.4381,214.2703 Q39.2287,214.2703 38.61,215.2336 Q37.9912,216.1969 37.9912,218.0812 Q37.9912,219.9656 38.61,220.9289 Q39.2287,221.8922 40.4381,221.8922 Q41.0006,221.8922 41.535,221.6461 Q42.0694,221.4 42.6319,220.8797 L42.6319,223.3266 Z "/><text fill="#000000" font-family="sans-serif" font-size="10.8" lengthAdjust="spacingAndGlyphs" textLength="62.1" x="57.24" y="221.9889">LoadedApk</text><line style="stroke: #A80036; stroke-width: 1.3499999642372131;" x1="6.3" x2="142.2" y1="232.65" y2="232.65"/><rect fill="none" height="5.4" style="stroke: #C82930; stroke-width: 0.8999999761581421;" width="5.4" x="12.6" y="240.6621"/><text fill="#000000" font-family="sans-serif" font-size="9.9" lengthAdjust="spacingAndGlyphs" textLength="114.3" x="23.4" y="245.4394">ArrayMap mReceivers;</text><line style="stroke: #A80036; stroke-width: 1.3499999642372131;" x1="6.3" x2="142.2" y1="251.3742" y2="251.3742"/><rect fill="#FEFECE" filter="url(#f1)" height="54.7242" style="stroke: #A80036; stroke-width: 1.3499999642372131;" width="135" x="527.175" y="45.45"/><ellipse cx="549.99" cy="59.85" fill="#B4A7E5" rx="9.9" ry="9.9" style="stroke: #A80036; stroke-width: 0.8999999761581421;"/><path d="M546.3197,56.0391 L546.3197,54.0984 L552.9712,54.0984 L552.9712,56.0391 L550.7494,56.0391 L550.7494,63.3094 L552.9712,63.3094 L552.9712,65.25 L546.3197,65.25 L546.3197,63.3094 L548.5415,63.3094 L548.5415,56.0391 L546.3197,56.0391 Z "/><text fill="#000000" font-family="sans-serif" font-size="10.8" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="85.5" x="564.66" y="63.5889">IIntentReceiver</text><line style="stroke: #A80036; stroke-width: 1.3499999642372131;" x1="528.075" x2="661.275" y1="74.25" y2="74.25"/><line style="stroke: #A80036; stroke-width: 1.3499999642372131;" x1="528.075" x2="661.275" y1="81.45" y2="81.45"/><ellipse cx="537.075" cy="92.1621" fill="#84BE84" rx="2.7" ry="2.7" style="stroke: #038048; stroke-width: 0.8999999761581421;"/><text fill="#000000" font-family="sans-serif" font-size="9.9" lengthAdjust="spacingAndGlyphs" textLength="111.6" x="545.175" y="94.2394">void performReceive()</text><rect fill="#FEFECE" filter="url(#f1)" height="54.7242" style="stroke: #A80036; stroke-width: 1.3499999642372131;" width="145.8" x="521.325" y="203.85"/><ellipse cx="534.825" cy="218.25" fill="#ADD1B2" rx="9.9" ry="9.9" style="stroke: #A80036; stroke-width: 0.8999999761581421;"/><path d="M537.4969,223.3266 Q536.9765,223.5937 536.4,223.7273 Q535.8234,223.8609 535.1906,223.8609 Q532.9406,223.8609 531.7523,222.3773 Q530.564,220.8937 530.564,218.0812 Q530.564,215.2687 531.7523,213.7781 Q532.9406,212.2875 535.1906,212.2875 Q535.8234,212.2875 536.407,212.4281 Q536.9906,212.5687 537.4969,212.8359 L537.4969,215.2828 Q536.9344,214.7625 536.4,214.5164 Q535.8656,214.2703 535.3031,214.2703 Q534.0937,214.2703 533.475,215.2336 Q532.8562,216.1969 532.8562,218.0812 Q532.8562,219.9656 533.475,220.9289 Q534.0937,221.8922 535.3031,221.8922 Q535.8656,221.8922 536.4,221.6461 Q536.9344,221.4 537.4969,220.8797 L537.4969,223.3266 Z "/><text fill="#000000" font-family="sans-serif" font-size="10.8" lengthAdjust="spacingAndGlyphs" textLength="117" x="547.425" y="221.9889">IIntentReceiver$Stub</text><line style="stroke: #A80036; stroke-width: 1.3499999642372131;" x1="522.225" x2="666.225" y1="232.65" y2="232.65"/><line style="stroke: #A80036; stroke-width: 1.3499999642372131;" x1="522.225" x2="666.225" y1="239.85" y2="239.85"/><ellipse cx="531.225" cy="250.5621" fill="#84BE84" rx="2.7" ry="2.7" style="stroke: #038048; stroke-width: 0.8999999761581421;"/><text fill="#000000" font-family="sans-serif" font-size="9.9" lengthAdjust="spacingAndGlyphs" textLength="111.6" x="539.325" y="252.6394">void performReceive()</text><rect fill="#FEFECE" filter="url(#f1)" height="66.2484" style="stroke: #A80036; stroke-width: 1.3499999642372131;" width="290.7" x="119.7" y="444.6"/><ellipse cx="133.2" cy="459" fill="#ADD1B2" rx="9.9" ry="9.9" style="stroke: #A80036; stroke-width: 0.8999999761581421;"/><path d="M135.8719,464.0766 Q135.3516,464.3437 134.775,464.4773 Q134.1984,464.6109 133.5656,464.6109 Q131.3156,464.6109 130.1273,463.1273 Q128.9391,461.6437 128.9391,458.8312 Q128.9391,456.0187 130.1273,454.5281 Q131.3156,453.0375 133.5656,453.0375 Q134.1984,453.0375 134.782,453.1781 Q135.3656,453.3187 135.8719,453.5859 L135.8719,456.0328 Q135.3094,455.5125 134.775,455.2664 Q134.2406,455.0203 133.6781,455.0203 Q132.4687,455.0203 131.85,455.9836 Q131.2312,456.9469 131.2312,458.8312 Q131.2312,460.7156 131.85,461.6789 Q132.4687,462.6422 133.6781,462.6422 Q134.2406,462.6422 134.775,462.3961 Q135.3094,462.15 135.8719,461.6297 L135.8719,464.0766 Z "/><text fill="#000000" font-family="sans-serif" font-size="10.8" lengthAdjust="spacingAndGlyphs" textLength="261.9" x="145.8" y="462.7389">LoadedApk$ReceiverDispatcher$InnerReceiver</text><line style="stroke: #A80036; stroke-width: 1.3499999642372131;" x1="120.6" x2="409.5" y1="473.4" y2="473.4"/><rect fill="none" height="5.4" style="stroke: #C82930; stroke-width: 0.8999999761581421;" width="5.4" x="126.9" y="481.4121"/><text fill="#000000" font-family="sans-serif" font-size="9.9" lengthAdjust="spacingAndGlyphs" textLength="68.4" x="137.7" y="486.1894">mDispatcher;</text><line style="stroke: #A80036; stroke-width: 1.3499999642372131;" x1="120.6" x2="409.5" y1="492.1242" y2="492.1242"/><ellipse cx="129.6" cy="502.8363" fill="#84BE84" rx="2.7" ry="2.7" style="stroke: #038048; stroke-width: 0.8999999761581421;"/><text fill="#000000" font-family="sans-serif" font-size="9.9" lengthAdjust="spacingAndGlyphs" textLength="111.6" x="137.7" y="504.9136">void performReceive()</text><rect fill="#FEFECE" filter="url(#f1)" height="54.7242" style="stroke: #A80036; stroke-width: 1.3499999642372131;" width="207" x="59.175" y="329.85"/><ellipse cx="72.675" cy="344.25" fill="#ADD1B2" rx="9.9" ry="9.9" style="stroke: #A80036; stroke-width: 0.8999999761581421;"/><path d="M75.3469,349.3266 Q74.8266,349.5937 74.25,349.7273 Q73.6734,349.8609 73.0406,349.8609 Q70.7906,349.8609 69.6023,348.3773 Q68.4141,346.8937 68.4141,344.0812 Q68.4141,341.2687 69.6023,339.7781 Q70.7906,338.2875 73.0406,338.2875 Q73.6734,338.2875 74.257,338.4281 Q74.8406,338.5687 75.3469,338.8359 L75.3469,341.2828 Q74.7844,340.7625 74.25,340.5164 Q73.7156,340.2703 73.1531,340.2703 Q71.9437,340.2703 71.325,341.2336 Q70.7062,342.1969 70.7062,344.0812 Q70.7062,345.9656 71.325,346.9289 Q71.9437,347.8922 73.1531,347.8922 Q73.7156,347.8922 74.25,347.6461 Q74.7844,347.4 75.3469,346.8797 L75.3469,349.3266 Z "/><text fill="#000000" font-family="sans-serif" font-size="10.8" lengthAdjust="spacingAndGlyphs" textLength="178.2" x="85.275" y="347.9889">LoadedApk$ReceiverDispatcher</text><line style="stroke: #A80036; stroke-width: 1.3499999642372131;" x1="60.075" x2="265.275" y1="358.65" y2="358.65"/><rect fill="none" height="5.4" style="stroke: #C82930; stroke-width: 0.8999999761581421;" width="5.4" x="66.375" y="366.6621"/><text fill="#000000" font-family="sans-serif" font-size="9.9" lengthAdjust="spacingAndGlyphs" textLength="84.6" x="77.175" y="371.4394">mIIntentReceiver</text><line style="stroke: #A80036; stroke-width: 1.3499999642372131;" x1="60.075" x2="265.275" y1="377.3742" y2="377.3742"/><rect fill="#FEFECE" filter="url(#f1)" height="66.2484" style="stroke: #A80036; stroke-width: 1.3499999642372131;" width="142.2" x="297.675" y="324"/><ellipse cx="311.175" cy="338.4" fill="#ADD1B2" rx="9.9" ry="9.9" style="stroke: #A80036; stroke-width: 0.8999999761581421;"/><path d="M313.8469,343.4766 Q313.3266,343.7437 312.75,343.8773 Q312.1734,344.0109 311.5406,344.0109 Q309.2906,344.0109 308.1023,342.5273 Q306.9141,341.0437 306.9141,338.2312 Q306.9141,335.4187 308.1023,333.9281 Q309.2906,332.4375 311.5406,332.4375 Q312.1734,332.4375 312.757,332.5781 Q313.3406,332.7187 313.8469,332.9859 L313.8469,335.4328 Q313.2844,334.9125 312.75,334.6664 Q312.2156,334.4203 311.6531,334.4203 Q310.4437,334.4203 309.825,335.3836 Q309.2062,336.3469 309.2062,338.2312 Q309.2062,340.1156 309.825,341.0789 Q310.4437,342.0422 311.6531,342.0422 Q312.2156,342.0422 312.75,341.7961 Q313.2844,341.55 313.8469,341.0297 L313.8469,343.4766 Z "/><text fill="#000000" font-family="sans-serif" font-size="10.8" lengthAdjust="spacingAndGlyphs" textLength="113.4" x="323.775" y="342.1389">ProxyIIntentReceiver</text><line style="stroke: #A80036; stroke-width: 1.3499999642372131;" x1="298.575" x2="438.975" y1="352.8" y2="352.8"/><rect fill="none" height="5.4" style="stroke: #C82930; stroke-width: 0.8999999761581421;" width="5.4" x="304.875" y="360.8121"/><text fill="#000000" font-family="sans-serif" font-size="9.9" lengthAdjust="spacingAndGlyphs" textLength="97.2" x="315.675" y="365.5894">IIntentReceiver old;</text><line style="stroke: #A80036; stroke-width: 1.3499999642372131;" x1="298.575" x2="438.975" y1="371.5242" y2="371.5242"/><ellipse cx="307.575" cy="382.2363" fill="#84BE84" rx="2.7" ry="2.7" style="stroke: #038048; stroke-width: 0.8999999761581421;"/><text fill="#000000" font-family="sans-serif" font-size="9.9" lengthAdjust="spacingAndGlyphs" textLength="111.6" x="315.675" y="384.3136">void performReceive()</text><polygon fill="#FBFB77" filter="url(#f1)" points="174.825,192.6,174.825,269.6976,489.825,269.6976,489.825,201.6,480.825,192.6,174.825,192.6" style="stroke: #A80036; stroke-width: 0.8999999761581421;"/><polygon fill="#FBFB77" points="174.825,192.6,174.825,269.6976,339.7221,269.6976,358.8543,323.7273,346.9221,269.6976,489.825,269.6976,489.825,201.6,480.825,192.6,174.825,192.6" style="stroke: #A80036; stroke-width: 0.8999999761581421;"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="480.825" x2="480.825" y1="192.6" y2="201.6"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="489.825" x2="480.825" y1="201.6" y2="201.6"/><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="268.2" x="180.225" y="207.9602">该类位于RegisterReceiver类，它是VA的hook类，</text><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="296.1" x="180.225" y="221.5797">用于hook IActivityManage的registerReceiver的方法，</text><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="0" x="183.825" y="235.1993"/><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="256.5" x="180.225" y="248.8188">ProxyIIntentReceiver类采用静态代理的方式替换</text><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="278.1" x="180.225" y="262.4383">registerReceiver方法中的IIntentReceiver Stub对象</text><path d="M99.7245,268.389 C113.6718,288.0288 130.6116,311.8833 143.3349,329.7996 " fill="none" style="stroke: #A80036; stroke-width: 0.8999999761581421;"/><polygon fill="#A80036" points="92.9461,258.8436,93.1378,265.3308,99.1997,267.6489,99.008,261.1617,92.9461,258.8436" style="stroke: #A80036; stroke-width: 0.8999999761581421;"/><path d="M594.225,118.521 C594.225,146.0376 594.225,180.3789 594.225,203.7042 " fill="none" style="stroke: #A80036; stroke-width: 0.8999999761581421;"/><polygon fill="none" points="587.925,118.3653,594.225,100.3653,600.525,118.3653,587.925,118.3653" style="stroke: #A80036; stroke-width: 0.8999999761581421;"/><path d="M565.6248,273.4947 C539.8479,308.3112 499.2453,357.5997 454.725,390.6 C425.1897,412.4925 389.223,430.607 356.5674,444.4977 " fill="none" style="stroke: #A80036; stroke-width: 0.8999999761581421;"/><polygon fill="none" points="560.5632,269.7426,576.2223,258.8571,570.7692,277.1316,560.5632,269.7426" style="stroke: #A80036; stroke-width: 0.8999999761581421;"/><path d="M240.3837,435.1947 C226.8855,418.4631 210.2238,399.6846 195.5835,384.8607 " fill="none" style="stroke: #A80036; stroke-width: 0.8999999761581421;"/><polygon fill="#A80036" points="247.725,444.5018,247.2068,438.0325,241.0358,436.0227,241.554,442.492,247.725,444.5018" style="stroke: #A80036; stroke-width: 0.8999999761581421;"/><path d="M182.6577,394.182 C195.291,410.1966 211.5522,428.9156 226.4004,444.5018 " fill="none" style="stroke: #A80036; stroke-width: 0.8999999761581421;"/><polygon fill="#A80036" points="175.4919,384.8607,175.9296,391.3359,182.0751,393.4223,181.6374,386.9471,175.4919,384.8607" style="stroke: #A80036; stroke-width: 0.8999999761581421;"/><path d="M529.6185,267.7203 C497.484,285.3882 458.9154,306.5931 427.5522,323.8371 " fill="none" style="stroke: #A80036; stroke-width: 0.8999999761581421;"/><polygon fill="none" points="526.9554,261.9954,545.7636,258.8436,533.0259,273.0366,526.9554,261.9954" style="stroke: #A80036; stroke-width: 0.8999999761581421;"/><path d="M332.2647,399.591 C319.4253,414.3285 305.1621,430.6996 293.0724,444.5766 " fill="none" style="stroke: #A80036; stroke-width: 0.8999999761581421;"/><polygon fill="#A80036" points="340.0434,390.663,333.7819,392.3699,332.9493,398.8063,339.2108,397.0994,340.0434,390.663" style="stroke: #A80036; stroke-width: 0.8999999761581421;"/></g></svg>