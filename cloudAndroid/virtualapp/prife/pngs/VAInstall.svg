<?xml version="1.0" encoding="UTF-8" standalone="yes"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" height="912px" style="width:1255px;height:912px;" version="1.1" viewBox="0 0 1255 912" width="1255px"><defs><filter height="300%" id="f1" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#f1)" height="765.3203" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="85.5" y="89.4297"/><rect fill="#FFFFFF" filter="url(#f1)" height="722.1875" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="225.5" y="118.5625"/><rect fill="#FFFFFF" filter="url(#f1)" height="663.9219" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="230.5" y="155.6953"/><rect fill="#FFFFFF" filter="url(#f1)" height="28" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="235.5" y="791.6172"/><rect fill="#FFFFFF" filter="url(#f1)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="405" y="189.8281"/><rect fill="#FFFFFF" filter="url(#f1)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="578.5" y="303.2266"/><rect fill="#FFFFFF" filter="url(#f1)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="747" y="362.3594"/><rect fill="#FFFFFF" filter="url(#f1)" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="905.5" y="421.4922"/><rect fill="#FFFFFF" filter="url(#f1)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1051" y="624.8203"/><rect fill="#ADD8E6" height="907.0469" style="stroke: #A80036; stroke-width: 1.0;" width="104" x="38.5" y="4"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="98" x="41.5" y="16.0669">Main process</text><rect fill="#90EE90" height="907.0469" style="stroke: #A80036; stroke-width: 1.0;" width="1004" x="144.5" y="4"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="110" x="591.5" y="16.0669">Server process</text><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="90" x2="90" y1="58.4297" y2="872.75"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="230.5" x2="230.5" y1="58.4297" y2="872.75"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="409.5" x2="409.5" y1="58.4297" y2="872.75"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="583.5" x2="583.5" y1="58.4297" y2="872.75"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="751.5" x2="751.5" y1="58.4297" y2="872.75"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="910.5" x2="910.5" y1="58.4297" y2="872.75"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1055.5" x2="1055.5" y1="58.4297" y2="872.75"/><rect fill="#FEFECE" filter="url(#f1)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="89" x="44" y="23.1328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="75" x="51" y="43.1279">VirtualCore</text><rect fill="#FEFECE" filter="url(#f1)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="89" x="44" y="871.75"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="75" x="51" y="891.7451">VirtualCore</text><rect fill="#FEFECE" filter="url(#f1)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="160" x="148.5" y="23.1328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="146" x="155.5" y="43.1279">VAppManagerService</text><rect fill="#FEFECE" filter="url(#f1)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="160" x="148.5" y="871.75"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="146" x="155.5" y="891.7451">VAppManagerService</text><rect fill="#FEFECE" filter="url(#f1)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="171" x="322.5" y="23.1328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="157" x="329.5" y="43.1279">PackageParserCompat</text><rect fill="#FEFECE" filter="url(#f1)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="171" x="322.5" y="871.75"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="157" x="329.5" y="891.7451">PackageParserCompat</text><rect fill="#FEFECE" filter="url(#f1)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="110" x="526.5" y="23.1328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="96" x="533.5" y="43.1279">VEnvironment</text><rect fill="#FEFECE" filter="url(#f1)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="110" x="526.5" y="871.75"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="96" x="533.5" y="891.7451">VEnvironment</text><rect fill="#FEFECE" filter="url(#f1)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="199" x="650.5" y="23.1328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="185" x="657.5" y="43.1279">NativeLibraryHelperCompat</text><rect fill="#FEFECE" filter="url(#f1)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="199" x="650.5" y="871.75"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="185" x="657.5" y="891.7451">NativeLibraryHelperCompat</text><rect fill="#FEFECE" filter="url(#f1)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="90" x="863.5" y="23.1328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="76" x="870.5" y="43.1279">AppSetting</text><rect fill="#FEFECE" filter="url(#f1)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="90" x="863.5" y="871.75"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="76" x="870.5" y="891.7451">AppSetting</text><rect fill="#FEFECE" filter="url(#f1)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="173" x="967.5" y="23.1328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="159" x="974.5" y="43.1279">StaticBroadcastSystem</text><rect fill="#FEFECE" filter="url(#f1)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="173" x="967.5" y="871.75"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="159" x="974.5" y="891.7451">StaticBroadcastSystem</text><rect fill="#FFFFFF" filter="url(#f1)" height="765.3203" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="85.5" y="89.4297"/><rect fill="#FFFFFF" filter="url(#f1)" height="722.1875" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="225.5" y="118.5625"/><rect fill="#FFFFFF" filter="url(#f1)" height="663.9219" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="230.5" y="155.6953"/><rect fill="#FFFFFF" filter="url(#f1)" height="28" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="235.5" y="791.6172"/><rect fill="#FFFFFF" filter="url(#f1)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="405" y="189.8281"/><rect fill="#FFFFFF" filter="url(#f1)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="578.5" y="303.2266"/><rect fill="#FFFFFF" filter="url(#f1)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="747" y="362.3594"/><rect fill="#FFFFFF" filter="url(#f1)" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="905.5" y="421.4922"/><rect fill="#FFFFFF" filter="url(#f1)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1051" y="624.8203"/><polygon fill="#A80036" points="73.5,85.4297,83.5,89.4297,73.5,93.4297,77.5,89.4297" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="3" x2="79.5" y1="89.4297" y2="89.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="62" x="10" y="84.4966">installApp</text><polygon fill="#A80036" points="213.5,114.5625,223.5,118.5625,213.5,122.5625,217.5,118.5625" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="95.5" x2="219.5" y1="118.5625" y2="118.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="62" x="102.5" y="113.6294">installApp</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="235.5" x2="282.5" y1="142.8281" y2="142.8281"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="282.5" x2="282.5" y1="142.8281" y2="155.8281"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="241.5" x2="282.5" y1="155.8281" y2="155.8281"/><polygon fill="#A80036" points="251.5,151.8281,241.5,155.8281,251.5,159.8281,247.5,155.8281" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="37" x="247.5" y="137.7622">install</text><polygon fill="#A80036" points="393,185.8281,403,189.8281,393,193.8281,397,189.8281" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="240.5" x2="399" y1="189.8281" y2="189.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="90" x="247.5" y="184.895">parsePackage</text><polygon fill="#FBFB77" filter="url(#f1)" points="28,232.9609,28,272.9609,429,272.9609,429,242.9609,419,232.9609,28,232.9609" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="419" x2="419" y1="232.9609" y2="242.9609"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="429" x2="419" y1="242.9609" y2="242.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="380" x="34" y="250.0278">接下来创建client应用需要的相关数据结构，并在VA的data目录下</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="326" x="34" y="265.1606">为client创建data目录，与系统中该应用的data目录隔离</text><polygon fill="#A80036" points="566.5,299.2266,576.5,303.2266,566.5,307.2266,570.5,303.2266" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="240.5" x2="572.5" y1="303.2266" y2="303.2266"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="319" x="247.5" y="298.2935">getDataAppPackageDirectory(pkg.packageName)</text><polygon fill="#A80036" points="735,358.3594,745,362.3594,735,366.3594,739,362.3594" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="240.5" x2="741" y1="362.3594" y2="362.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="122" x="247.5" y="357.4263">copyNativeBinaries</text><polygon fill="#A80036" points="893.5,417.4922,903.5,421.4922,893.5,425.4922,897.5,421.4922" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="240.5" x2="899.5" y1="421.4922" y2="421.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="110" x="247.5" y="416.5591">new AppSetting()</text><polygon fill="#A80036" points="251.5,446.625,241.5,450.625,251.5,454.625,247.5,450.625" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="245.5" x2="909.5" y1="450.625" y2="450.625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="145" x="257.5" y="445.6919">appSetting:AppSetting</text><polygon fill="#FBFB77" filter="url(#f1)" points="85,463.7578,85,594.7578,372,594.7578,372,473.7578,362,463.7578,85,463.7578" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="362" x2="362" y1="463.7578" y2="473.7578"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="372" x2="362" y1="473.7578" y2="473.7578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="266" x="91" y="480.8247">接下来构造AppSetting数据结构，其中包括：</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="91" y="495.9575">String packageName;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="91" y="511.0903">String apkPath;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="89" x="91" y="526.2231">String libPath;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="91" y="541.356">String odexDir;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="156" x="91" y="556.4888">boolean dependSystem;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="59" x="91" y="571.6216">int appId;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="185" x="91" y="586.7544">public PackageParser parser;</text><polygon fill="#A80036" points="1039,620.8203,1049,624.8203,1039,628.8203,1043,624.8203" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="240.5" x2="1045" y1="624.8203" y2="624.8203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="55" x="247.5" y="619.8872">startApp</text><polygon fill="#FBFB77" filter="url(#f1)" points="861,667.9531,861,752.9531,1246,752.9531,1246,677.9531,1236,667.9531,861,667.9531" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1236" x2="1236" y1="667.9531" y2="677.9531"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1246" x2="1236" y1="677.9531" y2="677.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="364" x="867" y="685.02">在这里处理client的静态广播接收器，核心思想是对Clientd每个</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="358" x="867" y="700.1528">static broadcast receiver分别注册一个动态广播接收器到VA</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="135" x="867" y="715.2856">应用（VA服务进程）。</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="302" x="867" y="730.4185">注意，VA会修改receiver的IntentFilter的ACTION。</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="256" x="867" y="745.5513">并且在这里设计了黑名单机制过滤ACTION。</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="245.5" x2="287.5" y1="783.75" y2="783.75"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="287.5" x2="287.5" y1="783.75" y2="796.75"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="246.5" x2="287.5" y1="796.75" y2="796.75"/><polygon fill="#A80036" points="256.5,792.75,246.5,796.75,256.5,800.75,252.5,796.75" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="113" x="252.5" y="778.6841">notifyAppInstalled</text><polygon fill="#A80036" points="106.5,836.75,96.5,840.75,106.5,844.75,102.5,840.75" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="100.5" x2="229.5" y1="840.75" y2="840.75"/><polygon fill="#A80036" points="14,850.75,4,854.75,14,858.75,10,854.75" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="8" x2="89.5" y1="854.75" y2="854.75"/></g></svg>