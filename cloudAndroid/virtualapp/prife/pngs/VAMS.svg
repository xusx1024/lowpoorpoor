<?xml version="1.0" encoding="UTF-8" standalone="yes"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" height="493.6px" style="width:711px;height:493px;" version="1.1" viewBox="0 0 711 493" width="711.2px"><defs><filter height="300%" id="f1" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="1.600000023841858"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="3.200000047683716" dy="3.200000047683716" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#f1)" height="145.8906" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="408.8" y="55.4375"/><rect fill="#FFFFFF" filter="url(#f1)" height="116.1844" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="412.8" y="85.1438"/><line style="stroke: #A80036; stroke-width: 0.800000011920929; stroke-dasharray: 5.0,5.0;" x1="412.8" x2="412.8" y1="30.6375" y2="463"/><line style="stroke: #A80036; stroke-width: 0.800000011920929; stroke-dasharray: 5.0,5.0;" x1="572.4" x2="572.4" y1="30.6375" y2="463"/><rect fill="#FEFECE" filter="url(#f1)" height="24.2375" style="stroke: #A80036; stroke-width: 1.2000000178813934;" width="144" x="339.2" y="2.4"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacingAndGlyphs" textLength="132.8" x="344.8" y="18.3961">VActivityManagerService</text><rect fill="#FEFECE" filter="url(#f1)" height="24.2375" style="stroke: #A80036; stroke-width: 1.2000000178813934;" width="144" x="339.2" y="462.2"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacingAndGlyphs" textLength="132.8" x="344.8" y="478.1961">VActivityManagerService</text><rect fill="#FEFECE" filter="url(#f1)" height="24.2375" style="stroke: #A80036; stroke-width: 1.2000000178813934;" width="106.4" x="518" y="2.4"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacingAndGlyphs" textLength="95.2" x="523.6" y="18.3961">PackageManager</text><rect fill="#FEFECE" filter="url(#f1)" height="24.2375" style="stroke: #A80036; stroke-width: 1.2000000178813934;" width="106.4" x="518" y="462.2"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacingAndGlyphs" textLength="95.2" x="523.6" y="478.1961">PackageManager</text><rect fill="#FFFFFF" filter="url(#f1)" height="145.8906" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="408.8" y="55.4375"/><rect fill="#FFFFFF" filter="url(#f1)" height="116.1844" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="412.8" y="85.1438"/><polygon fill="#A80036" points="399.2,52.2375,407.2,55.4375,399.2,58.6375,402.4,55.4375" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="2.4" x2="404" y1="55.4375" y2="55.4375"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="68.8" x="8" y="51.491">systemReady</text><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="416.8" x2="454.4" y1="74.85" y2="74.85"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="454.4" x2="454.4" y1="74.85" y2="85.25"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="421.6" x2="454.4" y1="85.25" y2="85.25"/><polygon fill="#A80036" points="429.6,82.05,421.6,85.25,429.6,88.45,426.4,85.25" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="47.2" x="426.4" y="70.7973">onCreate</text><polygon fill="#FBFB77" filter="url(#f1)" points="277.6,99.65,277.6,131.65,704,131.65,704,107.65,696,99.65,277.6,99.65" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="696" x2="696" y1="99.65" y2="107.65"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="704" x2="696" y1="107.65" y2="107.65"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="409.6" x="282.4" y="113.3035">调用getPackageInfo读取VA应用的AndroidManifest.xml中定义activity和provider组件</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="269.6" x="282.4" y="125.4098">GET_ACTIVITIES | GET_PROVIDERS | GET_META_DATA</text><polygon fill="#A80036" points="563.2,152.6625,571.2,155.8625,563.2,159.0625,566.4,155.8625" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="420.8" x2="568" y1="155.8625" y2="155.8625"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="78.4" x="426.4" y="151.916">getPackageInfo</text><polygon fill="#A80036" points="421.6,198.1281,413.6,201.3281,421.6,204.5281,418.4,201.3281" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><line style="stroke: #A80036; stroke-width: 0.800000011920929; stroke-dasharray: 2.0,2.0;" x1="416.8" x2="572" y1="201.3281" y2="201.3281"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="132.8" x="426.4" y="197.3816">packageInfo : PackageInfo</text><polygon fill="#FBFB77" filter="url(#f1)" points="6.4,166.3688,6.4,222.3688,401.6,222.3688,401.6,174.3688,393.6,166.3688,6.4,166.3688" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="393.6" x2="393.6" y1="166.3688" y2="174.3688"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="401.6" x2="393.6" y1="174.3688" y2="174.3688"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="276.8" x="11.2" y="180.0223">stubProcessList : 通过进程名字匹配检查是否是插件进程，</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="378.4" x="11.2" y="192.1285">疑问：进程名字在插件启动后会被设置成应用的包名，且process属性设置的:p1，</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="339.2" x="11.2" y="204.2348">那么应该用endWith来判断，为什么isAppProcess方法用contains判断？</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="0" x="14.4" y="216.341"/><polygon fill="#FBFB77" filter="url(#f1)" points="290.4,233.9938,290.4,447.5938,691.2,447.5938,691.2,241.9938,683.2,233.9938,290.4,233.9938" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="683.2" x2="683.2" y1="233.9938" y2="241.9938"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="691.2" x2="683.2" y1="241.9938" y2="241.9938"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="284" x="295.2" y="247.6473">遍历packageInfo.activities，将定义了如下META-DATA属性</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="355.2" x="295.2" y="259.7535">&lt;meta-data android:name="X-Identity" android:value="Stub-User"/&gt;</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="366.4" x="295.2" y="271.8598">的组件加入到stubProcessList中，这些Activity也就是用于双开应用而预先分配</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="52" x="295.2" y="283.966">的桩组件。</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="364" x="295.2" y="296.0723">VA会根据设置了两种类型的stub activity：1)普通的Activiy，2)对话框Activity</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="384" x="295.2" y="308.1785">以xml中设置的Activity的名称后缀是否以“_”结尾区别。“_"结尾的为对话框Activity</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="0" x="298.4" y="320.2848"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="44.8" x="295.2" y="332.391">&lt;activity</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="314.4" x="308" y="344.4973">android:name="com.lody.virtual.client.stub.StubActivity$C0_"</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="9.6" x="308" y="356.6035">...</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="114.4" x="308" y="368.7098">android:process=":p0"</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="208" x="308" y="380.816">android:taskAffinity="com.lody.virtual.vt"</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="250.4" x="308" y="392.9223">android:theme="@android:style/Theme.Dialog"&gt;</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="63.2" x="308" y="405.0285">&lt;meta-data</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="136" x="320.8" y="417.1348">android:name="X-Identity"</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="149.6" x="320.8" y="429.241">android:value="Stub-User"/&gt;</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="208" x="295.2" y="441.3473">之所以做此区别，是为了分别设置不同的主题</text></g></svg>